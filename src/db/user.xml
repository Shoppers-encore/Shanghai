<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User">
	<!-- User DB (member log-in) -->
	<select id="checkUserId" parameterType="String" resultType="int">
		select count(*) from jk_user where id=#{id} 
	</select>
	
	<!-- 상품의 갯수 불러오기 -->
	<select id="getProductCount" parameterType="java.util.Map" resultType="int">
		SELECT count(list.*) FROM (SELECT * FROM jk_good WHERE productCode!=TO_CHAR(ref) AND good_name LIKE '%'||#{searchWord}||'%') list <include refid="colorSearch"></include>
	</select>
	<select id="getProductList" parameterType="java.util.Map" resultType="databean.ProductDataBean">
		SELECT tmp.*, r FROM (SELECT list.*, rownum r FROM (SELECT * FROM jk_product WHERE productCode!=TO_CHAR(ref) ORDER BY productRegDate desc) list) tmp WHERE r &gt;= TO_NUMBER(#{start}) AND r &lt;= TO_NUMBER(#{end})
	</select>
	<select id="getReviewCount" parameterType="java.util.Map" resultType="int">
		SELECT count(*) From jk_review <include refid="search"></include>
	</select>
	<select id="getReviewList" parameterType="java.util.Map" resultType="databean.ReviewDataBean">
		SELECT tmp.* , r FROM (SELECT temp.* , rownum r FROM
			(SELECT * FROM jk_Review <include refid="search"></include> ORDER BY reviewDate desc) temp ORDER BY reviewDate desc) tmp WHERE r &gt;= TO_NUMBER(#{start}) AND r &lt;= TO_NUMBER(#{end})
	</select>
	
	
	<select id="getBasketList" parameterType="String" resultType="databean.BasketDataBean">
		SELECT * FROM jk_basket WHERE id=#{id}
	</select>
	<select id="getBasketCount" parameterType="String" resultType="int">
		Select count(*) FROM jk_basket WHERE id=#{id}
	</select>
  
	<sql id="search">
        <choose>
           <when test="searchType=='ttl'">
              WHERE title LIKE '%'||#{searchWord}||'%'
           </when>
           <when test="searchType=='ctt'">
              WHERE content LIKE '%'||#{searchWord}||'%'
           </when>
           <when test="searchType=='both'">
              WHERE title LIKE '%'||#{searchWord}||'%' OR content LIKE '%'||#{searchWord}||'%'
           </when>
           <when test="searchType=='writer'">
              WHERE id LIKE '%'||#{searchWord}||'%'
           </when>
           <otherwise>
               
           </otherwise>
        </choose>
     </sql>
	
	<sql id="colorSearch">
		WHERE
		<if test="selectedColors.contains('WH')">
			good_code LIKE 'WH'||'%' OR
		</if>
		<if test="selectedColors.contains('BK')">
			good_code LIKE 'BK'||'%' OR
		</if>
		<if test="selectedColors.contains('RD')">
			good_code LIKE 'RD'||'%' OR
		</if>
		<if test="selectedColors.contains('BL')">
			good_code LIKE 'BL'||'%' OR
		</if>
		<if test="selectedColors.contains('GN')">
			good_code LIKE 'GN'||'%' OR
		</if>
		<if test="selectedColors.contains('YL')">
			good_code LIKE 'YL'||'%' OR
		</if>
		<if test="selectedColors.contains('BR')">
			good_code LIKE 'BR'||'%' OR
		</if>
		<if test="selectedColors.contains('NV')">
			good_code LIKE 'NV'||'%' OR
		</if>
		<if test="selectedColors.contains('GR')">
			good_code LIKE 'GR'||'%' OR
		</if>
		<if test="selectedColors.contains('BG')">
			good_code LIKE 'BG'||'%' OR
		</if>
		<if test="selectedColors.contains('SK')">
			good_code LIKE 'SK'||'%' OR
		</if>
		<if test="selectedColors.contains('ETC')">
			good_code LIKE 'PK'||'%' OR
			good_code LIKE 'PP'||'%' OR
			good_code LIKE 'OR'||'%' OR
		</if>
		good_code = '0000'
	</sql>
</mapper>